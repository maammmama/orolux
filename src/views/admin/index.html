<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <!-- Authentication Check - Must be first script -->
    <script type="module" src="../../js/utils/authProtection.js"></script>
    <script type="module" src="../../js/modules/admin/index.js"></script>
    <script type="module" src="../../js/modules/admin/dashboard.js"></script>
    <!-- Keep your existing stylesheets -->
    <link rel="stylesheet" href="../../styles/admin/index.css">
    <link rel="stylesheet" href="../../styles/admin/shared/dashbord.css">
    <title>Admin Panel | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar {
            background: linear-gradient(180deg, #1a237e 0%, #283593 100%);
        }
        .dropdown-content {
            display: block;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s cubic-bezier(0.4,0,0.2,1), opacity 0.2s;
        }
        .dropdown-content.show {
            opacity: 1;
            max-height: 500px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        }
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .active-menu {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #60a5fa;
        }
        .revenue-bar {
            height: 30px;
            background: linear-gradient(90deg, #34d399 var(--percent), #e5e7eb var(--percent));
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .revenue-bar:hover {
            opacity: 0.9;
        }
        
        #content-area {
            height: 100vh;
            overflow-y: auto;
            padding-bottom: 2rem;
        }

        /* Fix header position */
        header {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Ensure main content starts below header */
        main {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Admin Layout -->
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar text-white w-64 fixed h-full flex flex-col transition-all duration-300">
            <!-- Logo -->
            <div class="p-4 flex items-center space-x-2 border-b border-gray-700">
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-cog text-white text-xl"></i>
                </div>
                <span class="logo-text text-xl font-bold">AdminPanel</span>
            </div>
            <!-- Main Menu -->
            <div class="flex-1 overflow-y-auto py-4">
                <ul class="space-y-1 px-2">
                    <li>
                        <a href="#" class="menu-item flex items-center p-3 rounded-lg hover:bg-gray-700 active-menu">
                            <i class="fas fa-tachometer-alt w-6 text-center"></i>
                            <span class="sidebar-text ml-3">Dashboard</span>
                        </a>
                    </li>
                    <!-- Product Management -->
                    <li>
                        <div class="dropdown">
                            <button onclick="toggleDropdown('products-dropdown')" class="menu-item flex items-center justify-between w-full p-3 rounded-lg hover:bg-gray-700">
                                <div class="flex items-center">
                                    <i class="fas fa-box-open w-6 text-center"></i>
                                    <span class="sidebar-text ml-3">Products</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
                            </button>
                            <ul id="products-dropdown" class="dropdown-content pl-4 mt-1 space-y-1">
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/proudacts.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-plus w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">Add New</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/edite-products.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-edit w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">Edit Products</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <!-- Order Management -->
                    <li>
                        <div class="dropdown">
                            <button onclick="toggleDropdown('orders-dropdown')" class="menu-item flex items-center justify-between w-full p-3 rounded-lg hover:bg-gray-700">
                                <div class="flex items-center">
                                    <i class="fas fa-shopping-cart w-6 text-center"></i>
                                    <span class="sidebar-text ml-3">Orders</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
                            </button>
                            <ul id="orders-dropdown" class="dropdown-content pl-4 mt-1 space-y-1">
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/all-orders.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-list w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">All Orders</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/order-status.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-truck w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">Order Status</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <!-- User Management -->
                    <li>
                        <div class="dropdown">
                            <button onclick="toggleDropdown('users-dropdown')" class="menu-item flex items-center justify-between w-full p-3 rounded-lg hover:bg-gray-700">
                                <div class="flex items-center">
                                    <i class="fas fa-users w-6 text-center"></i>
                                    <span class="sidebar-text ml-3">Users</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
                            </button>
                            <ul id="users-dropdown" class="dropdown-content pl-4 mt-1 space-y-1">
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/edite-users.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-list w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">User List</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <!-- Content Management -->
                    <li>
                        <div class="dropdown">
                            <button onclick="toggleDropdown('content-dropdown')" class="menu-item flex items-center justify-between w-full p-3 rounded-lg hover:bg-gray-700">
                                <div class="flex items-center">
                                    <i class="fas fa-file-alt w-6 text-center"></i>
                                    <span class="sidebar-text ml-3">Content</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
                            </button>
                            <ul id="content-dropdown" class="dropdown-content pl-4 mt-1 space-y-1">
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/terms-conditions.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-file-contract w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">Terms & Conditions</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/contact.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-envelope w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">Contact Info</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <!-- Analytics -->

                    <!-- Settings -->
                    <li>
                        <div class="dropdown">
                            <button onclick="toggleDropdown('settings-dropdown')" class="menu-item flex items-center justify-between w-full p-3 rounded-lg hover:bg-gray-700">
                                <div class="flex items-center">
                                    <i class="fas fa-cog w-6 text-center"></i>
                                    <span class="sidebar-text ml-3">Settings</span>
                                </div>
                                <i class="fas fa-chevron-down sidebar-text text-xs transition-transform duration-200"></i>
                            </button>
                            <ul id="settings-dropdown" class="dropdown-content pl-4 mt-1 space-y-1">
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/access.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-user-shield w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">Access Control</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/my-watch-colne/frontend/src/views/admin/2fa-settings.html" class="menu-item flex items-center p-2 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-lock w-5 text-center text-xs"></i>
                                        <span class="sidebar-text ml-3">2FA Settings</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <!-- Collapse Button -->
            <div class="p-4 border-t border-gray-700">
                <button onclick="toggleSidebar()" class="w-full flex items-center justify-center p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-chevron-left"></i>
                    <span class="sidebar-text ml-3">Collapse</span>
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div id="content-area" class="flex-1 ml-64 transition-all duration-300">
            <!-- Top Navigation -->
            <header class="bg-white shadow-sm z-10 fixed right-0 left-64 top-0">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center space-x-3">

                        <h1 class="text-xl font-semibold text-gray-800">Dashboard Overview</h1>
                    </div>
                      <!-- Header content -->
                    <div class="flex items-center space-x-4">
                    </div>
                </div>
            </header>
            
            <!-- Main Dashboard Content -->
            <main class="pt-16 px-6 pb-6">
                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Total Orders</p>
                                <h3 class="text-2xl font-bold mt-2" id="totalOrdersCount">0</h3>
                                <p class="text-green-500 text-xs mt-2">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span>From all time</span>
                                </p>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-full">
                                <i class="fas fa-shopping-cart text-blue-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Revenue</p>
                                <h3 class="text-2xl font-bold mt-2">28,450</h3>

                            </div>
                            <div class="bg-green-100 p-3 rounded-full">
                                <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Active Users</p>
                                <h3 class="text-2xl font-bold mt-2">842</h3>
  
                            </div>
                            <div class="bg-purple-100 p-3 rounded-full">
                                <i class="fas fa-users text-purple-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    

                </div>
                
                <!-- Sales Overview -->
                <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100 mb-6">
                    <h2 class="text-lg font-semibold mb-4">Sales Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Daily Revenue Chart -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-600 mb-4">Daily Revenue</h3>
                            <div class="space-y-2" id="daily-revenue">
                                <!-- Revenue bars will be added here -->
                            </div>
                        </div>
                        
                        <!-- Revenue Stats -->
                        <div class="space-y-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <p class="text-sm text-gray-600">Today's Revenue</p>
                                <h4 class="text-xl font-bold mt-1" id="today-revenue">MAD 0</h4>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <p class="text-sm text-gray-600">Weekly Revenue</p>
                                <h4 class="text-xl font-bold mt-1" id="weekly-revenue">MAD 0</h4>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <p class="text-sm text-gray-600">Monthly Revenue</p>
                                <h4 class="text-xl font-bold mt-1" id="monthly-revenue">MAD 0</h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders Section -->
                <div class="card mb-6" id="recent-orders-section">
                  <h2 class="text-xl font-semibold mb-4">Recent Orders</h2>
                  <div class="overflow-x-auto">
                    <table class="table w-full bg-white rounded">
                      <thead>
                        <tr>
                          <th class="py-2 px-4">Name</th>
                          <th class="py-2 px-4">Email</th>
                          <th class="py-2 px-4">Phone</th>
                          <th class="py-2 px-4">City</th>
                          <th class="py-2 px-4">Quantity</th>
                          <th class="py-2 px-4">Status</th>
                          <th class="py-2 px-4">Date</th>
                        </tr>
                      </thead>
                      <tbody id="recent-orders-table">
                        <!-- Orders will be injected here -->
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <!-- Recent Users and Top Products -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Recent Users -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h2 class="text-lg font-semibold">Recent Users</h2>
                                <button class="text-blue-500 text-sm">View All</button>
                            </div>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="w-10 h-10 rounded-full">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Robert Johnson</p>
                                    <p class="text-sm text-gray-500">robert@example.com</p>
                                </div>
                                <div class="ml-auto">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                                </div>
                            </div>
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://randomuser.me/api/portraits/women/76.jpg" alt="User" class="w-10 h-10 rounded-full">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Lisa Williams</p>
                                    <p class="text-sm text-gray-500">lisa@example.com</p>
                                </div>
                                <div class="ml-auto">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                                </div>
                            </div>
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://randomuser.me/api/portraits/men/41.jpg" alt="User" class="w-10 h-10 rounded-full">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Thomas Wilson</p>
                                    <p class="text-sm text-gray-500">thomas@example.com</p>
                                </div>
                                <div class="ml-auto">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Blocked</span>
                                </div>
                            </div>
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://randomuser.me/api/portraits/women/63.jpg" alt="User" class="w-10 h-10 rounded-full">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Emma Brown</p>
                                    <p class="text-sm text-gray-500">emma@example.com</p>
                                </div>
                                <div class="ml-auto">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Products -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h2 class="text-lg font-semibold">Top Selling Products</h2>
                                <button class="text-blue-500 text-sm">View All</button>
                            </div>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://via.placeholder.com/40" alt="Product" class="w-10 h-10 rounded">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Wireless Headphones</p>
                                    <p class="text-sm text-gray-500">Electronics</p>
                                </div>
                                <div class="ml-auto">
                                    <p class="text-sm font-medium text-gray-900">$89.99</p>
                                    <p class="text-sm text-gray-500">124 sold</p>
                                </div>
                            </div>
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://via.placeholder.com/40" alt="Product" class="w-10 h-10 rounded">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Smart Watch</p>
                                    <p class="text-sm text-gray-500">Wearables</p>
                                </div>
                                <div class="ml-auto">
                                    <p class="text-sm font-medium text-gray-900">$199.99</p>
                                    <p class="text-sm text-gray-500">87 sold</p>
                                </div>
                            </div>
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://via.placeholder.com/40" alt="Product" class="w-10 h-10 rounded">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Bluetooth Speaker</p>
                                    <p class="text-sm text-gray-500">Audio</p>
                                </div>
                                <div class="ml-auto">
                                    <p class="text-sm font-medium text-gray-900">$59.99</p>
                                    <p class="text-sm text-gray-500">76 sold</p>
                                </div>
                            </div>
                            <div class="px-6 py-4 flex items-center">
                                <img src="https://via.placeholder.com/40" alt="Product" class="w-10 h-10 rounded">
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">Fitness Tracker</p>
                                    <p class="text-sm text-gray-500">Wearables</p>
                                </div>
                                <div class="ml-auto">
                                    <p class="text-sm font-medium text-gray-900">$49.99</p>
                                    <p class="text-sm text-gray-500">65 sold</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>    <!-- Scripts -->
    <script src="/my-watch-colne/frontend/src/js/modules/admin/index.js"></script>
    <script src="/my-watch-colne/frontend/src/js/modules/admin/dashboard.js"></script>    <!-- Removed notification initialization -->
    <script>
    // Profile dropdown logic with slide/transition
    (function() {
        const profileBtn = document.getElementById('profileMenuBtn');
        const profileDropdown = document.getElementById('profile-dropdown');
        // Hide dropdown initially
        profileDropdown.classList.remove('show');
        // Toggle dropdown on click
        profileBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            // Close any other open dropdowns
            document.querySelectorAll('.dropdown-content.show').forEach(el => {
                if (el !== profileDropdown) el.classList.remove('show');
            });
            profileDropdown.classList.toggle('show');
        });
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (profileDropdown.classList.contains('show')) {
                if (!profileDropdown.contains(e.target) && e.target !== profileBtn) {
                    profileDropdown.classList.remove('show');
                }
            }
        });
        // Edit Profile
        document.getElementById('editProfileBtn').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = '/my-watch-colne/frontend/src/views/admin/edit-profile.html';
        });        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            const { logout } = await import('/my-watch-colne/frontend/src/js/utils/logoutUtils.js');
            await logout();
        });
    })();
    </script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
  const sidebar = document.getElementById('sidebar');
  const hamburgerBtn = document.getElementById('hamburger-btn');
  const contentArea = document.getElementById('content-area');

  if (hamburgerBtn && sidebar) {
    hamburgerBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      sidebar.classList.toggle('show');
    });

    // Close sidebar when clicking outside (on mobile)
    document.addEventListener('click', function(e) {
      if (
        window.innerWidth <= 900 &&
        sidebar.classList.contains('show') &&
        !sidebar.contains(e.target) &&
        !hamburgerBtn.contains(e.target)
      ) {
        sidebar.classList.remove('show');
      }
    });
  }
});
</script>
    <script>
// Update order count function
function updateOrderCount() {
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const totalOrdersElement = document.getElementById('totalOrdersCount');
    if (totalOrdersElement) {
        totalOrdersElement.textContent = orders.length;
    }
}

// Update count when page loads
document.addEventListener('DOMContentLoaded', updateOrderCount);

// Listen for storage changes
window.addEventListener('storage', function(e) {
    if (e.key === 'orders') {
        updateOrderCount();
    }
});
</script>
<script>
function updateRecentOrders() {
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    orders.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));
    const recent = orders.slice(0, 5);

    const tbody = document.getElementById('recent-orders-table');
    if (!tbody) return;

    if (recent.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" class="py-4 text-center text-gray-400">No orders found.</td></tr>`;
        return;
    }

    tbody.innerHTML = recent.map(order => `
        <tr>
            <td class="py-2 px-4">${order.firstName || ''} ${order.lastName || ''}</td>
            <td class="py-2 px-4">${order.email || ''}</td>
            <td class="py-2 px-4">${order.phone || ''}</td>
            <td class="py-2 px-4">${order.city || ''}</td>
            <td class="py-2 px-4">${order.quantity || ''}</td>
            <td class="py-2 px-4">${order.status || 'Pending'}</td>
            <td class="py-2 px-4">${order.orderDate ? new Date(order.orderDate).toLocaleDateString() : ''}</td>
        </tr>
    `).join('');
}

// Update on page load
document.addEventListener('DOMContentLoaded', updateRecentOrders);

// Update when orders change in any tab
window.addEventListener('storage', function(e) {
    if (e.key === 'orders') {
        updateRecentOrders();
    }
});

// Optional: If you add a new order from the same tab, call updateRecentOrders() after saving to localStorage
</script>
<script>
// Calculate and update total revenue in the dashboard
function updateTotalRevenue() {
    // Get all orders from localStorage
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    // Sum up the 'total' field for each order (as used in all-orders.html)
    const total = orders.reduce((sum, order) => {
        // Use order.total if present, else fallback to quantity * price if available
        let orderTotal = 0;
        if (typeof order.total === 'number') {
            orderTotal = order.total;
        } else if (order.quantity && order.price) {
            orderTotal = Number(order.quantity) * Number(order.price);
        }
        return sum + orderTotal;
    }, 0);

    // Format as currency (MAD, no decimals)
    const formatted = total.toLocaleString('en-MA', { style: 'currency', currency: 'MAD', maximumFractionDigits: 0 });

    // Find the Revenue card's value (the second statistics card)
    // It's the second .text-2xl.font-bold.mt-2 in the statistics grid
    const statCards = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4 .text-2xl.font-bold.mt-2');
    if (statCards.length > 1) {
        statCards[1].textContent = formatted;
    }
}

// Update on page load
document.addEventListener('DOMContentLoaded', updateTotalRevenue);

// Update when orders change in any tab
window.addEventListener('storage', function(e) {
    if (e.key === 'orders') {
        updateTotalRevenue();
    }
});
</script>
<script>
// Calculate and update active users in the dashboard (based on unique users in all orders)
function updateActiveUsersFromOrders() {
    // Get all orders from localStorage
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    // Use a Set to collect unique user emails (or phones if emails are missing)
    const uniqueUsers = new Set();
    orders.forEach(order => {
        // Prefer email, fallback to phone, fallback to name
        if (order.email) {
            uniqueUsers.add(order.email.trim().toLowerCase());
        } else if (order.phone) {
            uniqueUsers.add(order.phone.trim());
        } else if (order.firstName || order.lastName) {
            uniqueUsers.add((order.firstName || '') + ' ' + (order.lastName || ''));
        }
    });

    // Find the Active Users card's value (the third statistics card)
    // It's the third .text-2xl.font-bold.mt-2 in the statistics grid
    const statCards = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4 .text-2xl.font-bold.mt-2');
    if (statCards.length > 2) {
        statCards[2].textContent = uniqueUsers.size;
    }
}

// Update on page load
document.addEventListener('DOMContentLoaded', updateActiveUsersFromOrders);

// Update when orders change in any tab
window.addEventListener('storage', function(e) {
    if (e.key === 'orders') {
        updateActiveUsersFromOrders();
    }
});

// Update live when a new order is added in the same tab
(function() {
    const origSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
        origSetItem.apply(this, arguments);
        if (key === 'orders') {
            updateActiveUsersFromOrders();
        }
    };
})();
</script>
<script>
// Calculate and update total users in the dashboard (count = total orders)
function updateTotalUsersFromOrders() {
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    // Set the total users to the number of orders
    const statCards = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4 .text-2xl.font-bold.mt-2');
    if (statCards.length > 2) {
        statCards[2].textContent = orders.length;
    }
}

// Update on page load
document.addEventListener('DOMContentLoaded', updateTotalUsersFromOrders);

// Update when orders change in any tab
window.addEventListener('storage', function(e) {
    if (e.key === 'orders') {
        updateTotalUsersFromOrders();
    }
});

// Update live when a new order is added in the same tab
(function() {
    const origSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
        origSetItem.apply(this, arguments);
        if (key === 'orders') {
            updateTotalUsersFromOrders();
        }
    };
})();
</script>
<script>
// Sales Overview with real data
function updateSalesOverview() {
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    
    // Group orders by date
    const revenueByDate = {};
    const today = new Date();
    today.setHours(0,0,0,0);
    
    let maxRevenue = 0;
    
    orders.forEach(order => {
        if (!order.orderDate) return;
        const date = new Date(order.orderDate);
        date.setHours(0,0,0,0);
        const dateKey = date.toISOString().split('T')[0];
        
        // Calculate order total
        let orderTotal = 0;
        if (typeof order.total === 'number') {
            orderTotal = order.total;
        } else if (order.quantity && order.price) {
            orderTotal = Number(order.quantity) * Number(order.price);
        }
        
        revenueByDate[dateKey] = (revenueByDate[dateKey] || 0) + orderTotal;
        maxRevenue = Math.max(maxRevenue, revenueByDate[dateKey]);
    });
    
    // Calculate period totals
    const todayKey = today.toISOString().split('T')[0];
    const todayRevenue = revenueByDate[todayKey] || 0;
    
    let weeklyRevenue = 0;
    let monthlyRevenue = 0;
    
    Object.entries(revenueByDate).forEach(([date, amount]) => {
        const orderDate = new Date(date);
        const daysDiff = (today - orderDate) / (1000 * 60 * 60 * 24);
        
        if (daysDiff <= 7) weeklyRevenue += amount;
        if (daysDiff <= 30) monthlyRevenue += amount;
    });
    
    // Update revenue stats
    document.getElementById('today-revenue').textContent = 
        todayRevenue.toLocaleString('en-MA', { style: 'currency', currency: 'MAD', maximumFractionDigits: 0 });
    document.getElementById('weekly-revenue').textContent = 
        weeklyRevenue.toLocaleString('en-MA', { style: 'currency', currency: 'MAD', maximumFractionDigits: 0 });
    document.getElementById('monthly-revenue').textContent = 
        monthlyRevenue.toLocaleString('en-MA', { style: 'currency', currency: 'MAD', maximumFractionDigits: 0 });
    
    // Create daily revenue bars
    const dailyRevenueEl = document.getElementById('daily-revenue');
    dailyRevenueEl.innerHTML = '';
    
    Object.entries(revenueByDate)
        .sort((a, b) => b[0].localeCompare(a[0]))
        .slice(0, 7)
        .reverse()
        .forEach(([date, amount]) => {
            const percent = (amount / maxRevenue * 100).toFixed(1);
            const formattedDate = new Date(date).toLocaleDateString('en-GB', { 
                weekday: 'short', 
                day: 'numeric', 
                month: 'short' 
            });
            const formattedAmount = amount.toLocaleString('en-MA', { 
                style: 'currency', 
                currency: 'MAD',
                maximumFractionDigits: 0 
            });
            
            dailyRevenueEl.innerHTML += `
                <div class="flex items-center space-x-2">
                    <div class="w-20 text-sm text-gray-600">${formattedDate}</div>
                    <div class="revenue-bar flex-1" style="--percent: ${percent}%"></div>
                    <div class="w-24 text-sm text-gray-600 text-right">${formattedAmount}</div>
                </div>
            `;
        });
}

// Update on page load
document.addEventListener('DOMContentLoaded', updateSalesOverview);

// Update when orders change
window.addEventListener('storage', function(e) {
    if (e.key === 'orders') {
        updateSalesOverview();
    }
});
</script>
<script>
// Update Recent Users section with real order data
function updateRecentUsers() {
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const userContainer = document.querySelector('.bg-white.rounded-lg.shadow.overflow-hidden .divide-y.divide-gray-200');
    
    // Get unique users from orders
    const uniqueUsers = new Map();
    orders.forEach(order => {
        if (order.email && order.firstName && order.lastName) {
            uniqueUsers.set(order.email, {
                name: `${order.firstName} ${order.lastName}`,
                email: order.email,
                status: order.status || 'Active'
            });
        }
    });

    // Convert to array and sort by most recent
    const users = Array.from(uniqueUsers.values());
    
    if (users.length === 0) {
        userContainer.innerHTML = '<div class="px-6 py-4 text-gray-500">No users found</div>';
        return;
    }

    userContainer.innerHTML = users.slice(0, 4).map(user => `
        <div class="px-6 py-4 flex items-center">
            <div class="flex-shrink-0 h-10 w-10 bg-gray-200 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-gray-500"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-900">${user.name}</p>
                <p class="text-sm text-gray-500">${user.email}</p>
            </div>
            <div class="ml-auto">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                    ${user.status.toLowerCase() === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                    ${user.status}
                </span>
            </div>
        </div>
    `).join('');
}

// Update Top Selling Products section
function updateTopProducts() {
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const products = JSON.parse(localStorage.getItem('products') || '[]');
    const productContainer = document.querySelector('.bg-white.rounded-lg.shadow.overflow-hidden:last-child .divide-y.divide-gray-200');
    
    // Calculate product sales
    const productSales = new Map();
    orders.forEach(order => {
        if (order.productId && order.quantity) {
            const currentSales = productSales.get(order.productId) || { quantity: 0, revenue: 0 };
            currentSales.quantity += Number(order.quantity);
            currentSales.revenue += Number(order.quantity) * Number(order.price || 0);
            productSales.set(order.productId, currentSales);
        }
    });

    // Match with product details and sort by quantity sold
    const topProducts = products
        .filter(product => productSales.has(product.id))
        .map(product => ({
            ...product,
            sold: productSales.get(product.id).quantity,
            revenue: productSales.get(product.id).revenue
        }))
        .sort((a, b) => b.sold - a.sold);

    if (topProducts.length === 0) {
        productContainer.innerHTML = '<div class="px-6 py-4 text-gray-500">No products sold yet</div>';
        return;
    }

    productContainer.innerHTML = topProducts.slice(0, 4).map(product => `
        <div class="px-6 py-4 flex items-center">
            <div class="w-10 h-10 rounded bg-gray-200 flex items-center justify-center">
                ${product.image ? 
                    `<img src="${product.image}" alt="${product.name}" class="w-10 h-10 rounded object-cover">` :
                    '<i class="fas fa-box text-gray-400"></i>'
                }
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-900">${product.name}</p>
                <p class="text-sm text-gray-500">${product.category || 'Watches'}</p>
            </div>
            <div class="ml-auto">
                <p class="text-sm font-medium text-gray-900">
                    ${product.price?.toLocaleString('en-MA', { style: 'currency', currency: 'MAD', maximumFractionDigits: 0 })}
                </p>
                <p class="text-sm text-gray-500">${product.sold} sold</p>
            </div>
        </div>
    `).join('');
}

// Update both sections on page load and when data changes
function updateDashboardSections() {
    updateRecentUsers();
    updateTopProducts();
}

// Update on page load
document.addEventListener('DOMContentLoaded', updateDashboardSections);

// Update when orders or products change
window.addEventListener('storage', function(e) {
    if (e.key === 'orders' || e.key === 'products') {
        updateDashboardSections();
    }
});
</script>
<!-- Place inside your <header> or at the top of your main content area -->
<button id="hamburger-btn" class="lg:hidden p-2 text-gray-500 focus:outline-none" aria-label="Open sidebar">
  <i class="fas fa-bars text-xl"></i>
</button>
</body>
</html>