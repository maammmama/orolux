<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Replace the existing TailwindCSS CDN with this specific version -->
  <link href="https://cdn.tailwindcss.com?v=3.3.3" rel="stylesheet">
  <link rel="stylesheet" href="../../styles/cart/cart.css" />
  <link rel="stylesheet" href="../../styles/shared/header.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="../../images/logos/logo.png">
  <title>OROLUX STORE</title>
</head>
<body>
  <!-- Header -->
  <header class="main-header">
    <div class="header-container">
      <!-- Primary Navigation -->
      <nav class="primary-nav">
        <ul>
          <li><a href="/my-watch-colne/frontend/src/views/store/product.html">Watches</a></li>
          <li><a href="/my-watch-colne/frontend/src/views/store/">Watchmaking</a></li>
          <li><a href="/my-watch-colne/frontend/src/views/store/cart.html">Topics</a></li>
        </ul>
      </nav>

      <!-- Logo -->
      <div class="logo">
        <a href="/my-watch-colne/frontend/src/views/store/index.html">OROLUX STORE</a>
      </div>

      <!-- Secondary Navigation -->
      <nav class="secondary-nav">
        <ul>
          <li><a href="/my-watch-colne/frontend/src/views/store/product.html">Shop</a></li>
          <li><a href="/my-watch-colne/frontend/src/views/store/location.html">Find Retailer</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <h2>Shopping Cart</h2>

    <div class="cart-container" id="cart-items">
      <!-- Cart items will be rendered here dynamically -->
    </div>

    <div class="total_price">
      <h3>Total Price: 0.00 MAD</h3>
    </div>

    <button class="checkout_button">Checkout</button>
  </main>
    <!-- Footer -->
  <footer class="bg-black py-12 px-4">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-lg font-bold mb-4">OROLUX</h3>
          <ul class="space-y-2">
            <li><a href="#" class="text-gray-400 hover:text-white">About OROLUX</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white">Careers</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white">Corporate</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-4">CUSTOMER SERVICE</h3>
          <ul class="space-y-2">
            <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white">Warranty</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-4">LEGAL</h3>
          <ul class="space-y-2">
            <li><a href="#" class="text-gray-400 hover:text-white">Terms & Conditions</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white">Cookie Policy</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-4">FOLLOW US</h3>
          <div class="flex space-x-4 footer-social-links">
            <a id="footer-facebook" href="#" target="_blank" class="text-gray-400 hover:text-white">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a id="footer-twitter" href="#" target="_blank" class="text-gray-400 hover:text-white">
                <i class="fab fa-twitter"></i>
            </a>
            <a id="footer-instagram" href="#" target="_blank" class="text-gray-400 hover:text-white">
                <i class="fab fa-instagram"></i>
            </a>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-12 pt-8 text-center text-gray-500">
        <p>¬© 2025 OROLUX SA. All rights reserved.</p>
      </div>
    </div>
  </footer>
<div id="checkout-drawer" class="drawer">
    <div class="drawer-content">
        <div class="drawer-header">
            <h2>Delivery Information</h2>
            <button class="close-drawer">&times;</button>
        </div>
        <div class="drawer-body">
            <!-- Order summary section -->
            <div class="order-summary">
                <h3>Order Summary</h3>
                <div class="summary-content"></div>
                <div class="summary-total"></div>
            </div>
            
            <section class="delivery-info-section">
                <form class="delivery-form">
                    <div class="form-group">
                        <label for="first-name">First Name</label>
                        <input type="text" id="first-name" name="first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="last-name">Last Name</label>
                        <input type="text" id="last-name" name="last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" name="address" required>
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" id="city" name="city" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="message">Message (Optional)</label>
                        <textarea id="message" name="message" rows="3"></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Place Order</button>
                </form>
            </section>
        </div>
    </div>
</div>
<div class="sidebar-overlay" id="orderOverlay"></div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>
  <script src="/my-watch-colne/frontend/src/js/modules/state/cart.js"></script>
<script src="/my-watch-colne/frontend/src/js/modules/state/products.js"></script>
<script src="/my-watch-colne/frontend/src/js/modules/shared/footer.js"></script>
<script>
function handleError(error) {
    console.error('Cart error:', error);
}

// Wrap cart operations in try-catch
function updateTotal() {
    try {
        let total = 0;
        document.querySelectorAll('.cart_item').forEach(item => {
            const priceText = item.querySelector('.detail-value:nth-child(2)')?.textContent || '0';
            const price = parseFloat(priceText.replace(/[^\d.]/g, ''));
            const qty = parseInt(item.querySelector('.quantity-input')?.value || '1', 10);
            total += price * qty;
        });
        document.querySelector('.total_price h3').textContent = `Total Price: ${total.toFixed(2)} MAD`;
    } catch (error) {
        handleError(error);
    }
}

document.querySelectorAll('.remove-button').forEach(btn => {
  btn.addEventListener('click', function() {
    const cartItem = this.closest('.cart_item');
    if (cartItem) {
      const productId = cartItem.getAttribute('data-product-id');
      // Remove from localStorage
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      cart = cart.filter(item => item.id !== productId);
      localStorage.setItem('cart', JSON.stringify(cart));
      // Remove from DOM
      cartItem.remove();
      updateTotal();
    }
  });
});

document.querySelectorAll('.quantity-input').forEach(input => {
  input.addEventListener('change', updateTotal);
});

document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
  btn.addEventListener('click', function() {
    const input = this.parentElement.querySelector('.quantity-input');
    input.value = parseInt(input.value, 10) + 1;
    updateTotal();
  });
});
document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
  btn.addEventListener('click', function() {
    const input = this.parentElement.querySelector('.quantity-input');
    if (parseInt(input.value, 10) > 1) {
      input.value = parseInt(input.value, 10) - 1;
      updateTotal();
    }
  });
});

// Checkout button functionality
const checkoutBtn = document.querySelector('.checkout_button');
if (checkoutBtn) {
  checkoutBtn.addEventListener('click', function() {
    const cartItems = document.querySelectorAll('.cart_item');
    if (cartItems.length === 0) {
      alert('Your cart is empty!');
      return;
    }
    // Show the sidebar order form (use .active class for sliding effect)
    document.getElementById('orderSidebar').classList.add('active');
    document.getElementById('orderOverlay').classList.add('active');
    // Hide the support-question bubble
    const supportQuestion = document.getElementById('supportToggle');
    if (supportQuestion) supportQuestion.style.display = 'none';
  });
}

// Close sidebar
const closeSidebarBtn = document.querySelector('.close-order-sidebar');
if (closeSidebarBtn) {
  closeSidebarBtn.addEventListener('click', function() {
    document.getElementById('orderSidebar').classList.remove('active');
    document.getElementById('orderOverlay').classList.remove('active');
    // Show the support-question bubble again
    const supportQuestion = document.getElementById('supportToggle');
    if (supportQuestion) supportQuestion.style.display = '';
  });
}

// Hide sidebar overlay on click
const orderOverlay = document.getElementById('orderOverlay');
if (orderOverlay) {
  orderOverlay.addEventListener('click', function() {
    document.getElementById('orderSidebar').classList.remove('active');
    orderOverlay.classList.remove('active');
    // Show the support-question bubble again
    const supportQuestion = document.getElementById('supportToggle');
    if (supportQuestion) supportQuestion.style.display = '';
  });
}

// Order summary functionality
function renderOrderSummary() {
  const summaryEl = document.getElementById('orderSummary');
  const cartItems = document.querySelectorAll('.cart_item');
  let total = 0;
  let html = '<h3>Order Summary</h3>';
  if (cartItems.length === 0) {
    html += '<p>Your cart is empty.</p>';
    summaryEl.innerHTML = html;
    return;
  }
  html += '<ul style="margin-bottom: 1rem;">';
  cartItems.forEach(item => {
    const name = item.querySelector('.detail-value:nth-child(2)')?.textContent || '';
    const size = item.querySelector('.size-selector')?.value || '';
    const priceText = item.querySelector('.detail-value:nth-child(4)')?.textContent || '0';
    const price = parseFloat(priceText.replace(/[^\d.]/g, ''));
    const qty = parseInt(item.querySelector('.quantity-input')?.value || '1', 10);
    total += price * qty;
    html += `<li style=\"margin-bottom:8px;\"><strong>${name}</strong> (${size})<br>Price: ${price.toFixed(2)} MAD &times; ${qty}</li>`;
  });
  html += '</ul>';
  html += `<div style=\"font-weight:600;\">Total: ${total.toFixed(2)} MAD</div>`;
  summaryEl.innerHTML = html;
}

// Show summary when sidebar opens
const checkoutBtn2 = document.querySelector('.checkout_button');
if (checkoutBtn2) {
  checkoutBtn2.addEventListener('click', renderOrderSummary);
}
// Also update summary if quantities change or items are removed
[...document.querySelectorAll('.quantity-input'), ...document.querySelectorAll('.remove-button')].forEach(el => {
  el.addEventListener('change', renderOrderSummary);
  el.addEventListener('click', renderOrderSummary);
});

// Initial total
updateTotal();

// Initialize cart manager on page load
class CartManager {
    constructor() {
        this.cart = JSON.parse(localStorage.getItem('cart') || '[]');
    }

    updateCartUI() {
        const cartContainer = document.getElementById('cart-items');
        if (!cartContainer) return;

        cartContainer.innerHTML = '';
        
        this.cart.forEach(item => {
            if (!item) return;
            
            const cartItemHTML = `
                <div class="cart_item" data-product-id="${item.id || ''}">
                    <div class="detail-value">${item.name || ''}</div>
                    <div class="detail-value">${item.price || 0} MAD</div>
                    <div class="quantity-controls">
                        <button class="quantity-btn minus">-</button>
                        <input type="number" class="quantity-input" value="${item.quantity || 1}" min="1">
                        <button class="quantity-btn plus">+</button>
                    </div>
                    <button class="remove-button">Remove</button>
                </div>
            `;
            cartContainer.insertAdjacentHTML('beforeend', cartItemHTML);
        });
    }

    addEventListeners() {
        document.querySelectorAll('.remove-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const cartItem = e.target.closest('.cart_item');
                if (cartItem) {
                    const productId = cartItem.getAttribute('data-product-id');
                    this.removeItem(productId);
                }
            });
        });
    }

    removeItem(productId) {
        this.cart = this.cart.filter(item => item.id !== productId);
        localStorage.setItem('cart', JSON.stringify(this.cart));
        this.updateCartUI();
        updateTotal();
    }
}

window.cartManager = new CartManager();

function renderCartFromStorage() {
    // The CartManager class will handle the rendering
    if (typeof window.cartManager === 'undefined') {
        window.cartManager = new CartManager();
    }
    window.cartManager.updateCartUI();
}

// On page load, clear hardcoded items and render from storage
window.addEventListener('DOMContentLoaded', function() {
    renderCartFromStorage();
    updateTotal();
    if (window.cartManager && typeof window.cartManager.addEventListeners === 'function') {
        window.cartManager.addEventListeners();
    }
});
</script>
<div class="support-widget">
  <div class="support-links">
    <a href="/my-watch-colne/frontend/src/views/store/FQL.html">FAQ on orders</a>
    <a href="/my-watch-colne/frontend/src/views/store/FQL.html">FAQ on shipment</a>
    <a href="/my-watch-colne/frontend/src/views/store/terms-conditions.html">Warranty</a>
  </div>

  <div class="contact-options">
    <a href="#" class="contact-option" id="startLiveChat">
      <span class="icon">üí¨</span>
      Begin live chat
    </a>
    
    <a href="mailto:mailto:orolux.stor1@gmail.com" class="contact-option">
      <span class="icon">‚úâÔ∏è</span>
      Connect via email
    </a>
    
    <div class="phone-support">
      <a href="tel:+212 74889226" class="contact-option">
        <span class="icon">üìû</span>
        +212 74889226
      </a>
      <p class="support-hours">Monday to Friday, 9 am ‚Äì 5 pm (Central European Time)</p>
    </div>
  </div>
</div>

<div class="chat-window" id="chatWindow">
  <div class="chat-header">
    <span>Chat with us</span>
    <span class="chat-close" id="chatClose">&times;</span>
  </div>
  <div class="chat-messages" id="chatMessages">
    <!-- Messages will be inserted here -->
  </div>
  <div class="chat-input">
    <input type="text" placeholder="Type your message..." id="chatInput">
    <button id="chatSend">Send</button>
  </div>
</div>

<div class="support-question" id="supportToggle">
  <span class="icon">üí≠</span>
  Do you have any questions?
</div>
</body>
</html>
