// Sample product data
        const productsData = {
            "1": {
                id: 1,
                name: "Rolex Submariner Date",
                sku: "RLX-124060",
                category: "watches",
                brand: "Rolex",
                price: 8999,
                discountPrice: 8499,
                discountActive: true,
                currency: "USD",
                quantity: 5,
                status: true,
                visibility: true,
                mainImage: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                galleryImages: [
                    "https://images.unsplash.com/photo-1542496658-e33a6d0d50f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                    "https://images.unsplash.com/photo-1548169874-53e85f753f1e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                    "https://images.unsplash.com/photo-1523170335258-f5ed11844a49?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
                ],
                shortDescription: "The Rolex Submariner is the reference among divers' watches. Launched in 1953, it was the first wristwatch waterproof to a depth of 100 meters.",
                fullDescription: "<h3>Rolex Submariner Date - 124060</h3><p>The Rolex Submariner is the reference among divers' watches. Launched in 1953, it was the first wristwatch waterproof to a depth of 100 meters.</p><p><strong>Key Features:</strong></p><ul><li>Oystersteel case and bracelet</li><li>41mm case diameter</li><li>Waterproof to 300 meters (1,000 feet)</li><li>Chromalight display for optimal legibility in dark conditions</li><li>Self-winding mechanical movement, Caliber 3230</li><li>Approximately 70 hours of power reserve</li></ul>",
                movement: "Automatic, Caliber 3230",
                caseMaterial: "Oystersteel (904L steel)",
                waterResistance: "300 meters / 1000 feet",
                powerReserve: "Approx. 70 hours",
                caseDiameter: "41mm",
                bracelet: "Oyster, flat three-piece links",
                metaTitle: "Rolex Submariner Date 124060 - Luxury Diver's Watch",
                metaKeywords: "Rolex, Submariner, luxury watch, diver's watch, 124060, automatic watch",
                metaDescription: "The Rolex Submariner Date 124060 is a legendary diver's watch with 300m water resistance, automatic movement, and iconic design. Shop the authentic Rolex Submariner collection."
            },
            "2": {
                id: 2,
                name: "Omega Seamaster",
                sku: "OM-21030422001001",
                category: "watches",
                brand: "Omega",
                price: 5200,
                discountPrice: 4900,
                discountActive: true,
                currency: "USD",
                quantity: 8,
                status: true,
                visibility: true,
                mainImage: "https://images.unsplash.com/photo-1542496658-e33a6d0d50f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                galleryImages: [
                    "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                    "https://images.unsplash.com/photo-1548169874-53e85f753f1e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
                ],
                shortDescription: "The Omega Seamaster collection is a tribute to Omega's maritime heritage and the innovative technology that makes these watches the choice of underwater explorers.",
                fullDescription: "<h3>Omega Seamaster Professional</h3><p>The Omega Seamaster collection is a tribute to Omega's maritime heritage and the innovative technology that makes these watches the choice of underwater explorers.</p><p><strong>Key Features:</strong></p><ul><li>Stainless steel case and bracelet</li><li>42mm case diameter</li><li>Water resistant to 300 meters (1,000 feet)</li><li>Master Chronometer Certified (METAS)</li><li>Self-winding movement with Co-Axial escapement</li><li>Helium escape valve</li></ul>",
                movement: "Automatic, Co-Axial Master Chronometer",
                caseMaterial: "Stainless steel",
                waterResistance: "300 meters / 1000 feet",
                powerReserve: "Approx. 55 hours",
                caseDiameter: "42mm",
                bracelet: "Stainless steel with foldover clasp",
                metaTitle: "Omega Seamaster Professional Diver 300M",
                metaKeywords: "Omega, Seamaster, diver watch, luxury watch, professional",
                metaDescription: "The Omega Seamaster Professional Diver 300M is a high-precision timepiece with 300m water resistance, certified by METAS as a Master Chronometer."
            },
            "3": {
                id: 3,
                name: "Cartier Tank Solo",
                sku: "CR-WGTA0010",
                category: "watches",
                brand: "Cartier",
                price: 6750,
                discountPrice: 0,
                discountActive: false,
                currency: "USD",
                quantity: 3,
                status: false,
                visibility: false,
                mainImage: "https://images.unsplash.com/photo-1548169874-53e85f753f1e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                galleryImages: [
                    "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80",
                    "https://images.unsplash.com/photo-1542496658-e33a6d0d50f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"
                ],
                shortDescription: "The Cartier Tank Solo watch is a contemporary interpretation of the legendary Tank watch, first created by Louis Cartier in 1917.",
                fullDescription: "<h3>Cartier Tank Solo</h3><p>The Cartier Tank Solo watch is a contemporary interpretation of the legendary Tank watch, first created by Louis Cartier in 1917.</p><p><strong>Key Features:</strong></p><ul><li>Stainless steel case</li><li>Quartz movement</li><li>Roman numeral dial</li><li>Blue steel hands</li><li>Sapphire cabochon on the crown</li><li>Water resistant to 30 meters</li></ul>",
                movement: "Quartz",
                caseMaterial: "Stainless steel",
                waterResistance: "30 meters / 100 feet",
                powerReserve: "N/A (Quartz)",
                caseDiameter: "31mm x 31mm",
                bracelet: "Black alligator leather strap",
                metaTitle: "Cartier Tank Solo - Classic Luxury Watch",
                metaKeywords: "Cartier, Tank Solo, luxury watch, quartz watch, classic",
                metaDescription: "The Cartier Tank Solo is a contemporary interpretation of the legendary Tank watch, featuring a stainless steel case and quartz movement."
            }
        };

        // Current selected product
        let currentProduct = null;

        // Tab switching functionality
        const tabs = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.add('hidden'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Show corresponding content
                const contentId = tab.id.replace('-tab', '-content');
                document.getElementById(contentId).classList.remove('hidden');
            });
        });

        // Rich text editor buttons
        const richTextButtons = document.querySelectorAll('.rich-text-btn');
        richTextButtons.forEach(button => {
            button.addEventListener('click', () => {
                const command = button.getAttribute('data-command');
                document.execCommand(command, false, null);
            });
        });

        // Delete modal functionality
        const deleteBtn = document.getElementById('delete-btn');
        const deleteModal = document.getElementById('delete-modal');
        const modalClose = document.getElementById('modal-close');
        const cancelDelete = document.getElementById('cancel-delete');
        const confirmDelete = document.getElementById('confirm-delete');

        deleteBtn.addEventListener('click', () => {
            document.getElementById('delete-product-name').textContent = currentProduct.name;
            deleteModal.classList.remove('hidden');
        });

        [modalClose, cancelDelete].forEach(btn => {
            btn.addEventListener('click', () => {
                deleteModal.classList.add('hidden');
            });
        });

        confirmDelete.addEventListener('click', () => {
            deleteModal.classList.add('hidden');
            // Here you would typically send a request to delete the product
            alert('Product deleted successfully!');
            showProductSelection();
        });

        // Save button functionality
        const saveBtn = document.getElementById('save-btn');
        const successNotification = document.getElementById('success-notification');

        saveBtn.addEventListener('click', () => {
            // Here you would typically send a request to update the product
            successNotification.classList.remove('hidden');
            setTimeout(() => {
                successNotification.classList.add('hidden');
            }, 3000);
        });

        // Image deletion
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-image-btn') || e.target.closest('.delete-image-btn')) {
                e.stopPropagation();
                const imagePreview = e.target.closest('.image-preview');
                if (confirm('Are you sure you want to delete this image?')) {
                    imagePreview.remove();
                }
            }
        });

        // Close modal when clicking outside
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.classList.add('hidden');
            }
        });

        // Show product selection page
        function showProductSelection() {
            document.getElementById('product-selection').classList.remove('hidden');
            document.getElementById('edit-product-page').classList.add('hidden');
        }

        // Select product and load edit page
        function selectProduct(element, productId) {
            // Remove selected class from all cards
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            element.classList.add('selected');
            
            // Find the product in our data
            currentProduct = productsData[productId];
            
            // Load product data into form
            loadProductData(currentProduct);
            
            // Show edit page
            document.getElementById('product-selection').classList.add('hidden');
            document.getElementById('edit-product-page').classList.remove('hidden');
        }

        // Load product data into form
        function loadProductData(product) {
            // Basic Info
            document.getElementById('product-name').value = product.name;
            document.getElementById('sku').value = product.sku;
            document.getElementById('category').value = product.category;
            document.getElementById('brand').value = product.brand;
            
            // Pricing
            document.getElementById('price').value = product.price;
            document.getElementById('discount-price').value = product.discountPrice;
            document.getElementById('discount-active').checked = product.discountActive;
            document.getElementById('currency').value = product.currency;
            
            // Inventory
            document.getElementById('quantity').value = product.quantity;
            document.getElementById('status').checked = product.status;
            document.getElementById('visibility').checked = product.visibility;
            
            // Images
            document.getElementById('main-image-preview').src = product.mainImage;
            document.getElementById('main-image-preview').alt = product.name;
            
            const galleryContainer = document.getElementById('gallery-container');
            galleryContainer.innerHTML = '';
            
            product.galleryImages.forEach(imageUrl => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'image-preview relative group w-full h-40 bg-gray-100 rounded-md overflow-hidden border border-gray-200';
                galleryItem.innerHTML = `
                    <img src="${imageUrl}" alt="Gallery image" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition flex items-center justify-center opacity-0 group-hover:opacity-100">
                        <button class="delete-image-btn p-2 bg-red-500 text-white rounded-full hover:bg-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                galleryContainer.appendChild(galleryItem);
            });
            
            // Description
            document.getElementById('short-description').value = product.shortDescription;
            document.getElementById('full-description').innerHTML = product.fullDescription;
            
            // Specifications
            document.getElementById('movement').value = product.movement;
            document.getElementById('case-material').value = product.caseMaterial;
            document.getElementById('water-resistance').value = product.waterResistance;
            document.getElementById('power-reserve').value = product.powerReserve;
            document.getElementById('case-diameter').value = product.caseDiameter;
            document.getElementById('bracelet').value = product.bracelet;
            
            // SEO
            document.getElementById('meta-title').value = product.metaTitle;
            document.getElementById('meta-keywords').value = product.metaKeywords;
            document.getElementById('meta-description').value = product.metaDescription;
        }

        // Search functionality
        document.getElementById('search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('.product-card').forEach(card => {
                const productName = card.querySelector('h3').textContent.toLowerCase();
                const sku = card.querySelector('.text-xs').textContent.split(': ')[1].toLowerCase();
                
                if (productName.includes(searchTerm) || sku.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Category filter
        document.getElementById('category-filter').addEventListener('change', (e) => {
            const category = e.target.value;
            document.querySelectorAll('.product-card').forEach(card => {
                const productCategory = card.querySelector('p').textContent.toLowerCase();
                
                if (!category || productCategory === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Status filter
        document.getElementById('status-filter').addEventListener('change', (e) => {
            const status = e.target.value;
            document.querySelectorAll('.product-card').forEach(card => {
                const productStatus = card.querySelector('span').textContent.toLowerCase();
                
                if (!status || productStatus === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // 1. Move this to the top, outside of DOMContentLoaded:
let products = JSON.parse(localStorage.getItem('products') || '[]');
if (products.length === 0 && typeof productsData !== 'undefined') {
    products = Object.values(productsData).flat();
}

// 2. Now your DOMContentLoaded and renderProducts use this products array

document.addEventListener('DOMContentLoaded', function() {
    // Get the product grid container
    const productGrid = document.querySelector('#product-selection .grid');

    // Render product cards
    function renderProducts() {
        if (!productGrid) return;
        productGrid.innerHTML = '';

        if (!products || products.length === 0) {
            productGrid.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-8">No products found.</div>';
            return;
        }

        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card bg-white rounded-lg shadow p-6 flex flex-col items-center mb-6';
            card.innerHTML = `
                <img src="${product.mainImage || '/my-watch-colne/frontend/src/images/products/arrival-1.png'}" alt="${product.name}" class="product-image w-64 h-64 object-contain mb-4">
                <h3 class="font-semibold text-lg mb-2">${product.name}</h3>
                <p class="text-gray-500 text-base mb-2">${product.price ? product.price + ' MAD' : ''}</p>
                <div class="flex gap-2 mt-2">
                    <button class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm edit-btn" data-edit="${product.id}">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                    <button class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm" data-delete="${product.id}">
                        <i class="fas fa-trash mr-1"></i>Delete
                    </button>
                </div>
                <form class="edit-area mt-4 w-full bg-gray-50 p-4 rounded shadow-inner hidden" data-form="${product.id}">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium">Product Name</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="name" value="${product.name || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Category</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="category" value="${product.category || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Collection</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="collection" value="${product.collection || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">SKU/Product Code</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="sku" value="${product.sku || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Brand</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="brand" value="${product.brand || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Price</label>
                            <input type="number" class="w-full border rounded px-2 py-1" name="price" value="${product.price || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Discount Price</label>
                            <input type="number" class="w-full border rounded px-2 py-1" name="discountPrice" value="${product.discountPrice || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Discount Active</label>
                            <input type="checkbox" name="discountActive" ${product.discountActive ? 'checked' : ''}>
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Quantity</label>
                            <input type="number" class="w-full border rounded px-2 py-1" name="quantity" value="${product.quantity || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Status</label>
                            <select name="status" class="w-full border rounded px-2 py-1">
                                <option value="true" ${product.status ? 'selected' : ''}>Active</option>
                                <option value="false" ${!product.status ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Visibility</label>
                            <select name="visibility" class="w-full border rounded px-2 py-1">
                                <option value="true" ${product.visibility ? 'selected' : ''}>Visible</option>
                                <option value="false" ${!product.visibility ? 'selected' : ''}>Hidden</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Main Image</label>
                            <input type="file" name="mainImage" accept="image/*" class="w-full border rounded px-2 py-1 mb-2">
                            <img src="${product.mainImage || '/my-watch-colne/frontend/src/images/products/arrival-1.png'}" alt="Main Image" class="w-24 h-24 object-cover rounded mb-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Gallery Images</label>
                            <input type="file" name="galleryImages" accept="image/*" multiple class="w-full border rounded px-2 py-1 mb-2">
                            <div class="flex flex-wrap gap-2">
                                ${(product.galleryImages || []).map(img => `
                                    <div class="relative">
                                        <img src="${img}" alt="Gallery" class="w-16 h-16 object-cover rounded">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium">Details</label>
                        <textarea class="w-full border rounded px-2 py-1" name="shortDescription">${product.shortDescription || ''}</textarea>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium">Technical Data</label>
                        <textarea class="w-full border rounded px-2 py-1" name="fullDescription">${product.fullDescription || ''}</textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium">Movement</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="movement" value="${product.movement || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Water Resistance</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="waterResistance" value="${product.waterResistance || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Case Diameter</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="caseDiameter" value="${product.caseDiameter || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Case Material</label>
                            <input type="text" class="w-full border rounded px-2 py-1" name="caseMaterial" value="${product.caseMaterial || ''}">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium">Meta Title</label>
                        <input type="text" class="w-full border rounded px-2 py-1" name="metaTitle" value="${product.metaTitle || ''}">
                    </div>
                    <div class="mt-2">
                        <label class="block text-sm font-medium">Meta Keywords</label>
                        <input type="text" class="w-full border rounded px-2 py-1" name="metaKeywords" value="${product.metaKeywords || ''}">
                    </div>
                    <div class="mt-2">
                        <label class="block text-sm font-medium">Meta Description</label>
                        <textarea class="w-full border rounded px-2 py-1" name="metaDescription">${product.metaDescription || ''}</textarea>
                    </div>
                    <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 mt-4">Save</button>
                    <button type="button" class="cancel-edit ml-2 px-3 py-1 rounded bg-gray-300 hover:bg-gray-400 mt-4">Cancel</button>
                </form>
            `;
            productGrid.appendChild(card);
        });

        // Add event listeners for edit buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = btn.getAttribute('data-edit');
                const form = document.querySelector(`form[data-form="${id}"]`);
                form.classList.toggle('hidden');
            });
        });

        // Add event listeners for cancel buttons
        document.querySelectorAll('.cancel-edit').forEach(btn => {
            btn.addEventListener('click', function() {
                btn.closest('form').classList.add('hidden');
            });
        });

        // Handle form submission for editing
        document.querySelectorAll('.edit-area').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const id = form.getAttribute('data-form');
                const idx = products.findIndex(p => p.id == id);
                if (idx !== -1) {
                    // Update all fields
                    products[idx].name = form.name.value;
                    products[idx].category = form.category.value;
                    products[idx].collection = form.collection.value;
                    products[idx].sku = form.sku.value;
                    products[idx].brand = form.brand.value;
                    products[idx].price = form.price.value;
                    products[idx].discountPrice = form.discountPrice.value;
                    products[idx].discountActive = form.discountActive.checked;
                    products[idx].quantity = form.quantity.value;
                    products[idx].status = form.status.value === "true";
                    products[idx].visibility = form.visibility.value === "true";
                    products[idx].shortDescription = form.shortDescription.value;
                    products[idx].fullDescription = form.fullDescription.value;
                    products[idx].movement = form.movement.value;
                    products[idx].waterResistance = form.waterResistance.value;
                    products[idx].caseDiameter = form.caseDiameter.value;
                    products[idx].caseMaterial = form.caseMaterial.value;
                    products[idx].metaTitle = form.metaTitle.value;
                    products[idx].metaKeywords = form.metaKeywords.value;
                    products[idx].metaDescription = form.metaDescription.value;

                    // Handle main image upload
                    const imageInput = form.mainImage;
                    if (imageInput && imageInput.files && imageInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(evt) {
                            products[idx].mainImage = evt.target.result;
                            handleGalleryImages();
                        };
                        reader.readAsDataURL(imageInput.files[0]);
                    } else {
                        handleGalleryImages();
                    }

                    function handleGalleryImages() {
                        // Handle gallery images upload
                        const galleryInput = form.galleryImages;
                        if (galleryInput && galleryInput.files && galleryInput.files.length > 0) {
                            const files = Array.from(galleryInput.files);
                            let loaded = 0;
                            let galleryArr = [];
                            files.forEach(file => {
                                const reader = new FileReader();
                                reader.onload = function(evt) {
                                    galleryArr.push(evt.target.result);
                                    loaded++;
                                    if (loaded === files.length) {
                                        products[idx].galleryImages = galleryArr;
                                        localStorage.setItem('products', JSON.stringify(products));
                                        renderProducts();
                                    }
                                };
                                reader.readAsDataURL(file);
                            });
                        } else {
                            // If no new gallery images, keep the old ones
                            localStorage.setItem('products', JSON.stringify(products));
                            renderProducts();
                        }
                    }
                }
            });
        });
    }

    renderProducts();

    // (Optional) Add event listeners for edit/delete here
});

// 3. The delete handler will now work:
document.addEventListener('click', function(e) {
    // Check if the clicked element is a delete button or inside one
    const btn = e.target.closest('[data-delete]');
    if (btn) {
        const id = btn.getAttribute('data-delete');
        if (confirm('Are you sure you want to delete this product?')) {
            const idx = products.findIndex(p => p.id == id);
            if (idx !== -1) {
                products.splice(idx, 1);
                localStorage.setItem('products', JSON.stringify(products));
                renderProducts();
            }
        }
    }
});